"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[682],{45685:(e,t,n)=>{n.r(t),n.d(t,{EnhancedPlaylist:()=>ve,default:()=>pe});var a=n(59713),r=n.n(a),i=n(63038),l=n.n(i),c=(n(68309),n(47941),n(82526),n(57327),n(41539),n(38880),n(89554),n(54747),n(49337),n(33321),n(69070),n(67294)),o=n.n(c),u=n(48556),s=n(95661),d=n(13020),m=n(70369),v=n(55120),p=n(83979),f=n(20657),b=n(30947),y=n(55911),g=n(20246),h=n(43620),x=n(84242),E=n(1496),k=n(6479),I=n.n(k),P=n(48926),R=n.n(P),w=n(87757),C=n.n(w),O=(n(91038),n(78783),n(26541),n(92222),n(9653),n(94967)),T=n(11680),j=n(45287),U=["pageItems"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function F(e,t,n,a){var i=a?{}:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return t.forEach((function(e,t){i[n+t]=e})),i}var B=n(32567),_=(n(21249),n(35308)),D=n(28248),S=n(73785),M=n(4236),A=n(42922),L=n(7073),z=n(49961),Z=(n(69600),n(44461)),X=n(9296),q=n(52284),G=n(86213),K=n(27481),Q=n(83384),$=n(82760),J=n(32626),W=n(65095),H=n(87257),V=n(57978),Y=n(75016),ee=n(24656),te=n(84788),ne=n(94184),ae=n.n(ne),re=n(83692);const ie="TRDgmejiOzKjissuLFSx";var le=function(e){var t=e.onClick,n=void 0===t?function(){}:t,a=e.className,r=e.label,i=e.ariaLabel,l=void 0===i?r:i,c=e.Icon;return o().createElement(re.w,{label:r},o().createElement("button",{type:"button","aria-label":l,className:ae()(ie,a),onClick:n},o().createElement(c,{iconSize:16})))},ce=o().memo((function(e){var t,n=e.uri,a=e.uid,r=e.name,i=e.durationMs,u=e.artists,s=e.album,d=e.isMOGEFRestricted,m=e.isExplicit,v=e.isPlayable,p=e.index,b=e.playIndex,y=void 0===b?null:b,g=e.imgUrl,h=e.contextUri,x=e.usePlayContextItem,E=e.isEnhanced,k=e.playContextPageIndex,I=e.add,P=e.remove,R=e.canBeRemovedFromPlaylist,w=(0,(0,c.useContext)(ee.I).useCurrentAvailability)(n),C=l()(w,2),O=C[0],T=C[1],j=v&&O,U=(0,te.r)({offlineAvailability:T,isExplicit:m,isMOGEFRestricted:d,isEnhanced:E}),N=U.badges,F=U.hasBadges,B=p+1,_=u.items.map((function(e){return{uri:e.uri,name:e.profile.name}})),D=o().createElement(G.$,{uri:n,uid:a,albumUri:null==s?void 0:s.uri,artists:_,contextUri:h,isRecommendation:E,removePlaylistItems:function(){return P(a)},removeRecommendation:function(){return P(a)},addRecommendation:function(){return I(a)},canBeRemovedFromPlaylist:R}),S=(null==_?void 0:_.map((function(e){return e.name})).join(f.ag.getSeparator()))||"",M=x({uid:a,uri:n,index:null!=y?y:p,pageIndex:k}),L=M.isActive,z=M.isPlaying,ne=M.triggerPlay,ae=M.togglePlay;return o().createElement(A.ZP,{value:"row",index:p},o().createElement(J._P,{menu:D},o().createElement($.c,{uri:n,contextUri:h,index:p,onTriggerPlay:function(){ne()},isActive:L,ariaRowIndex:p+1,isPlayable:j,ageRestricted:d,dragMetadata:{name:r,createdBy:S}},o().createElement(K.Dd,{ariaColIndex:0},o().createElement(K.Du,{uri:n,playAriaLabel:f.ag.get("tracklist.a11y.play",r,S),onClick:function(){ae()},isPlaying:z,isActive:L},o().createElement(K.km,null,B))),o().createElement(K.vZ,{ariaColIndex:1},o().createElement(K.lD,{src:g}),o().createElement(K.vm,null,o().createElement(K.Wh,{titleText:r},r),F&&o().createElement(K.g3,null,N.enhanced&&o().createElement(Z.J,{iconSize:16,className:Q.Z.enhanced,"aria-label":f.ag.get("web-player.enhance.button_text_enhanced")}),N.download&&o().createElement(W.G,{size:16}),N.explicit&&o().createElement(H.N,null),N.paid&&o().createElement(Y.g,null),N.nineteen&&o().createElement(V.X,{className:Q.Z.nineteen,size:16})),o().createElement(K.K9,null,o().createElement(K.T6,{artists:_})))),o().createElement(K.UA,{ariaColIndex:2},o().createElement(K.BM,{uri:s.uri,name:s.name,creatorUri:null==_||null===(t=_[0])||void 0===t?void 0:t.uri},s.name)),o().createElement(K.mU,{ariaColIndex:3},!!E&&o().createElement(o().Fragment,null,o().createElement(le,{onClick:function(){return I(a)},label:f.ag.get("web-player.enhance.button_label_keep_in_playlist"),Icon:X.Z}),o().createElement(le,{onClick:function(){return P(a)},label:f.ag.get("web-player.enhance.button_label_remove_from_playlist"),Icon:q.w})),o().createElement(K.A$,{duration:i}),o().createElement(K.Zv,{menu:D,label:f.ag.get("more.label.track",r,S)})))))})),oe=[S.Q.INDEX,S.Q.TITLE,S.Q.ALBUM,S.Q.DURATION],ue=o().memo((function(e){var t=e.ariaLabel,n=e.uri,a=e.name,r=e.usePlayContextItem,i=e.tracklistRef,u=e.fetchTracks,s=e.addRecommendation,d=e.removeRecommendation,m=e.nrTracks,v=e.canBeRemovedFromPlaylist,p=(0,c.useRef)(!1),b=(0,M.k)();(0,c.useEffect)((function(){var e;p.current&&b&&(null==i||null===(e=i.current)||void 0===e||e.update());p.current=!0}),[b,i]);var y=(0,c.useRef)((function(){})),g=(0,c.useState)([]),h=l()(g,2),x=h[0],E=h[1],k=(0,c.useCallback)((function(){var e,t=null==i||null===(e=i.current)||void 0===e?void 0:e.getVisibleTrackWindow(),n=t.firstIndex,a=t.lastIndex-n;return Math.max(0,n-Math.round((50-a)/2))}),[i]),I=(0,c.useCallback)((function(e){y.current(),d({itemIds:e.map((function(e){return e.id})),offset:k(),limit:50})}),[d,k]),P=(0,c.useCallback)((function(e,t){y.current=t,e.length>1?E(e):I(e)}),[I]),R=(0,c.useCallback)((function(e){s({itemIds:[e],offset:k(),limit:50})}),[s,k]),w=(0,c.useCallback)((function(e){d({itemIds:[e],offset:k(),limit:50})}),[d,k]),C=(0,c.useCallback)((function(e,t){var a,i,l,c=(0,z.X)(null===(a=e.album.coverArt)||void 0===a?void 0:a.sources,{desiredSize:40,desiredLabel:"small"});return o().createElement(ce,{key:e.uid,index:t,playIndex:t,contextUri:n,uri:e.uri,uid:e.uid,isPlayable:e.playability.playable,durationMs:e.duration.totalMilliseconds,name:e.name,artists:e.artists,album:e.album,isExplicit:(null===(i=e.contentRating)||void 0===i?void 0:i.label)===L.KS.Explicit,isMOGEFRestricted:(null===(l=e.contentRating)||void 0===l?void 0:l.label)===L.KS.NineteenPlus,imgUrl:(null==c?void 0:c.url)||"",usePlayContextItem:r,isEnhanced:e.isEnhanced,playContextPageIndex:e.playContextPageIndex,add:R,remove:w,canBeRemovedFromPlaylist:v})}),[r,n,R,w,v]),O=(0,c.useCallback)((function(e){return e.uri}),[]),T=(0,c.useCallback)((function(e){return e.uid}),[]);return o().createElement(o().Fragment,null,o().createElement(A.ZP,{value:"playlist-tracklist"},o().createElement(D.Pv,{testID:"playlist-tracklist",key:n,ariaLabel:t,hasHeaderRow:!0,columns:oe,onRemove:P,renderRow:C,resolveUri:O,resolveUid:T,nrTracks:m,fetchTracks:u,limit:50,outerRef:i})),o().createElement(_.h,{title:f.ag.get("playlist.remove_from_playlist",a),isOpen:x.length>0,tracks:x,onClose:function(e){e.stopPropagation(),E([])},onRemove:I}))}));const se={xs:"(min-width: 0px)",xsOnly:"(min-width: 0px) and (max-width: 767px)",sm:"(min-width: 768px)",smOnly:"(min-width: 768px) and (max-width: 1023px)",md:"(min-width: 1024px)",mdOnly:"(min-width: 1024px) and (max-width: 1279px)",lg:"(min-width: 1280px)",lgOnly:"(min-width: 1280px) and (max-width: 1919px)",xl:"(min-width: 1920px)",enhancedPlaylist:"OfFtIpc_qctF95n1Xk6p",playlistImageContainer:"q91bEN94vb8qNievR8JN"};function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ve=o().memo((function(e){var t=e.metadata,n=t.uri,a=t.name,r=t.images,i=t.totalLength,k=t.canPlay,P=t.canRemove,w=l()(r,1)[0],N=(0,h.Z)((null==w?void 0:w.url)||null),_=(0,c.useRef)(null),D=function(e){var t,n=(0,T._)(),a=(0,j.U)(e),r=a.isEnhanced,i=a.iteration,o=a.setIsEnhanced,u=a.toggleIsEnhanced,s=(0,c.useState)(null),d=l()(s,2),m=d[0],v=d[1],p=(0,c.useRef)({}),f=(0,c.useRef)(null),b=(0,c.useCallback)(function(){var e=R()(C().mark((function e(t,a,r,i,l,c,o){var u,s,d,m,b,y,g,h,x,E;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b=null===(u=f.current)||void 0===u?void 0:u.enhancedRevision,e.prev=1,e.next=4,o;case 4:y=e.sent,e.next=13;break;case 7:if(e.prev=7,e.t0=e.catch(1),409!==(null===e.t0||void 0===e.t0?void 0:e.t0.status)){e.next=13;break}return e.next=12,n.getPage(t,a,r,i,l);case 12:y=e.sent;case 13:if(g=null===(s=y)||void 0===s?void 0:s.enhancePage){e.next=16;break}return e.abrupt("return",[]);case 16:return h=g.pageItems,x=I()(g,U),e.next=19,n.decoratePageItems(h);case 19:if(E=e.sent,b===(null===(d=f.current)||void 0===d?void 0:d.enhancedRevision)){e.next=23;break}return e.abrupt("return",[]);case 23:return(null===(m=f.current)||void 0===m?void 0:m.enhancedRevision)!==x.enhancedRevision&&(c=!0),p.current=F(p.current,E,i,c),v(x),f.current=x,e.abrupt("return",E);case 29:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,a,r,i,l,c){return e.apply(this,arguments)}}(),[n]),y=(0,c.useCallback)(function(){var t=R()(C().mark((function t(a){var r,l,c,o,u;return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a.itemIds,l=a.offset,c=void 0===l?0:l,o=a.limit,u=void 0===o?1:o,f.current&&i){t.next=3;break}return t.abrupt("return");case 3:b(e,i,f.current.sessionId,c,u,!0,n.addRecommendation(e,f.current.sessionId,f.current.contextRevision,r,c,u));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[b,e,n,i]),g=(0,c.useCallback)(function(){var t=R()(C().mark((function t(a){var r,l,c,o,u;return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a.itemIds,l=a.offset,c=void 0===l?0:l,o=a.limit,u=void 0===o?1:o,f.current&&i){t.next=3;break}return t.abrupt("return");case 3:b(e,i,f.current.sessionId,c,u,!0,n.removeRecommendation(e,f.current.sessionId,f.current.contextRevision,r,c,u));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[b,e,n,i]),h=(0,c.useMemo)((function(){return new O.tL}),[]),x=(0,c.useCallback)(function(){var t=R()(C().mark((function t(a,r){var l,c,o,u,s;return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",[]);case 2:if(u=Math.min(r,((null===(l=f.current)||void 0===l?void 0:l.numTotalItems)||1/0)-a),!(s=Array.from({length:u},(function(e,t){return p.current[t+a]}))).every((function(e){return!!e}))){t.next=7;break}return t.abrupt("return",s);case 7:return t.abrupt("return",b(e,i,null===(c=f.current)||void 0===c?void 0:c.sessionId,a,r,!1,h.create("".concat(e,":").concat(i,":").concat(null===(o=f.current)||void 0===o?void 0:o.sessionId,":").concat(a,":").concat(r),(function(){var t;return n.getPage(e,i,null===(t=f.current)||void 0===t?void 0:t.sessionId,a,r)}))));case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),[h,b,e,n,i]);return{isEnhanced:r,setIsEnhanced:o,toggleIsEnhanced:u,addRecommendation:y,removeRecommendation:g,playContext:(0,c.useMemo)((function(){return{uri:e,url:null==m?void 0:m.dspContextUri}}),[e,null==m?void 0:m.dspContextUri]),numTotalItems:isNaN(Number(null==m?void 0:m.numTotalItems))?void 0:Number(null==m?void 0:m.numTotalItems),numTotalRecs:isNaN(Number(null==m?void 0:m.numTotalRecs))?void 0:Number(null==m?void 0:m.numTotalRecs),fetchTracks:x,enhancedRevision:null==m?void 0:m.enhancedRevision,UBIReason:m?"enhanced|".concat(null==m?void 0:m.sessionId,"#").concat(null==m||null===(t=m.logging)||void 0===t?void 0:t.correlationId):"enhanced|"}}(n),S=D.playContext,M=D.numTotalItems,A=D.addRecommendation,L=D.removeRecommendation,z=D.fetchTracks,Z=D.enhancedRevision,X=D.UBIReason;(0,c.useEffect)((function(){var e;Z&&(null===(e=_.current)||void 0===e||e.update())}),[Z]);var q=(0,E.fU)(u.createDesktopEnhancedEventFactory,{data:{uri:n,identifier:"enhanced-session",reason:X}}),G=q.spec,K=q.logger,Q=q.UBIFragment,$=(0,x.n)(S,{featureIdentifier:"playlist"}),J=$.isPlaying,W=$.isActive,H=$.togglePlay,V=$.usePlayContextItem,Y=(0,c.useCallback)((function(){var e;H(),e=W?J?G.playButtonFactory().hitPause({itemToBePaused:n}):G.playButtonFactory().hitResume({itemToBeResumed:n}):G.playButtonFactory().hitPlay({itemToBePlayed:n}),K.logInteraction(e)}),[H,J,W,K,G,n]),ee=(0,c.useCallback)((function(){var e=G.headerFactory().enhanceButtonFactory().hitUnenhanceContext({contextToBeUnenhanced:n});K.logInteraction(e)}),[K,G,n]);return o().createElement(c.Suspense,{fallback:null},o().createElement(Q,{spec:G},o().createElement(m.$,null,f.ag.get("playlist.page-title",a)),o().createElement("section",{role:"presentation",className:se.enhancedPlaylist,"data-testid":"enhanced-playlist-page"},o().createElement(p.s,{metadata:me(me({},t),{},{duration:null,totalLength:null!=M?M:i}),isPlaying:J,togglePlay:Y,backgroundColor:N}),o().createElement("div",{className:se.playlistContent},o().createElement(b.o,{backgroundColor:N},o().createElement(b.F,null,k?o().createElement(v.$,{onClick:Y,isPlaying:J,size:y.qE.lg,uri:n}):null,o().createElement(B.v,{uri:n,onClick:ee}),o().createElement(g.y,{menu:o().createElement(d.X,{uri:n})},o().createElement(s.z,null))))),o().createElement("div",{className:"contentSpacing"},o().createElement(c.Suspense,{fallback:null},o().createElement(ue,{key:n,ariaLabel:a,nrTracks:null!=M?M:Math.max(15,i),uri:n,name:a,usePlayContextItem:V,tracklistRef:_,fetchTracks:z,addRecommendation:A,removeRecommendation:L,canBeRemovedFromPlaylist:P}))))))}));const pe=ve}}]);
//# sourceMappingURL=xpui-routes-enhanced-playlist.js.map